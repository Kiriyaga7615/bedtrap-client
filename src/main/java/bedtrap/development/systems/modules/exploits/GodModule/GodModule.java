package bedtrap.development.systems.modules.exploits.GodModule;

import bedtrap.development.events.event.GameJoinedEvent;
import bedtrap.development.events.event.OpenScreenEvent;
import bedtrap.development.events.event.PacketEvent;
import bedtrap.development.events.event.TickEvent;
import bedtrap.development.systems.modules.Module;
import bedtrap.development.systems.utils.game.ChatUtils;
import com.google.common.eventbus.Subscribe;
import net.minecraft.client.gui.screen.DeathScreen;
import net.minecraft.network.packet.s2c.play.DeathMessageS2CPacket;

@Module.Info(name = "GodModule", category = Module.Category.Exploits)
public class GodModule extends Module {

    private boolean b = false;

    @Override
    public void onDeactivate() {
        super.onDeactivate();
        if (b) {
            b = false;
            ChatUtils.info(this.name,"Toggling gode modul......");
            if (mc.player != null && mc.player.networkHandler != null)
                mc.player.requestRespawn();
        }
    }

    @Subscribe
    private void onGameJoin(GameJoinedEvent event) {
        b = false;
    }

    @Subscribe
    private void onPreTick(TickEvent.Pre event) {
        if (b && mc.player != null) {
            if (mc.player.getHealth() < 1f)
                mc.player.setHealth(20f);
            if (mc.player.getHungerManager().getFoodLevel() < 20)
                mc.player.getHungerManager().setFoodLevel(20);
        }
    }

    @Subscribe
    private void onPacketRecieve(OpenScreenEvent event) {
        if (event.screen instanceof DeathScreen) {
            event.cancel();
            if (!b) {
                b = true;
                info(this.name, "Gode modul activated, now you can only spectate.");
            }
        }
    }
}
